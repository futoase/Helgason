{% extends 'layout.html' %}

{% block title %}Post request viewer{% endblock %}

{% block script %}
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<script type="text/javascript">
  var hostname = window.location.hostname;
  var socketIoJs = {
    addPort : (
      "http://" + 
      hostname +
      ":{{ port }}/socket.io/socket.io.js"
    ),
    noPort: (
      "http://" + 
      hostname +
      "/socket.io/socket.io.js"
    )
  };

  function postMessage(setting) {
    // Set client by use of socket.io.
    if (setting.usePort === true) {
      var socket = io.connect("http://" + hostname + ":{{ port }}");
    }
    else {
      var socket = io.connect("http://" + hostname);
    }
    socket.on("send-message", function(data) {
      $("#message").append(
        (data.status.basic === true ? "is basic auth" : "no basic auth") +
        " " +
        data.status.method + 
        " " + 
        JSON.stringify(data.message)
      );
      $("#message").append($("<br/>"));
    });
  }

  // Loaded socket.io.js
  $.get(socketIoJs.addPort).done(function () {
    $.getScript(socketIoJs.addPort).done(function () {
      postMessage({ usePort: true });
    });
  }).fail(function() {
    $.get(socketIoJs.noPort).done(function() {
      $.getScript(socketIoJs.noPort).done(function () {
        postMessage({ usePort: false });
      });
    }).fail(function () {
      alert("socket.io loaded error...");
    });
  });

</script>
{% endblock %}

{% block main %}
<p><b>Messages</b></p>
<div id="message"></div>
{% endblock %}
